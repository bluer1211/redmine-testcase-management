<div class="box tabular">
  <p>
    <%= form.label l(:field_test_plan) %>
    <% if @test_plan_given && @test_plan %>
      <%= @test_plan.name %>
      <%= form.hidden_field :test_plan_id, :value => @test_plan.id %>
    <% else %>
      <% 
        # 在編輯模式下，預選當前測試案例的第一個測試計劃
        selected_test_plan_id = nil
        if @test_case.persisted? && @test_case.test_plans.any?
          selected_test_plan_id = @test_case.test_plans.first.id
        end
      %>
      <%= form.select :test_plan_id, @test_plan_candidates, 
                      { selected: selected_test_plan_id, include_blank: true }, 
                      { class: 'select2' } %>
    <% end %>
  </p>
  <p>
    <%= form.label l(:field_test_case_name) %>
    <%= form.text_field :name, size: 80, required: true, id: "name" %>
  </p>
  <p>
    <%= form.label l(:field_user) %>
    <% if @test_case and @test_case.user %>
      <%= form.select :user, @user_candidates, selected: @test_case.user.id %>
    <% else %>
      <%= form.select :user, @user_candidates %>
    <% end %>
  </p>
  <p>
    <%= form.label l(:field_environment) %>
    <%= form.text_field :environment, size: 80, id: "environment" %>
  </p>
  <p>
    <%= form.label l(:field_scenario) %>
    <%= form.text_area :scenario, required: true, id: "scenario", cols: 60, rows: [[10, @test_case.scenario.to_s.length / 50].max, 20].min %>
  </p>
  <p>
    <%= form.label l(:field_expected) %>
    <%= form.text_area :expected, required: true, id: "expected", cols: 60, rows: [[10, @test_case.expected.to_s.length / 50].max, 20].min %>
  </p>
</div>

<div class="box">
  <p>
    <%= form.label l :label_attachment_plural %>
    <%= render partial: 'attachments/form' %>
  </p>
</div>
